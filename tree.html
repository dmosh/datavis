<!DOCTYPE html>
<html>
<head>
  <title>Collapsible Tree Graph</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    /* Add any custom styles here */
    .key {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      margin-bottom: 10px;
    }
    
    .key-circle {
      width: 12px;
      height: 12px;
      margin-right: 5px;
    }
    
    .key-text {
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div class="key">
    <div class="key-circle" style="background-color: #1f77b4;"></div>
    <div class="key-text">Root</div>
  </div>
  <div class="key">
    <div class="key-circle" style="background-color: #ff7f0e;"></div>
    <div class="key-text">District</div>
  </div>
  <div class="key">
    <div class="key-circle" style="background-color: #2ca02c;"></div>
    <div class="key-text">Village</div>
  </div>
  <div class="key">
    <div class="key-circle" style="background-color: #d62728;"></div>
    <div class="key-text">Parameter</div>
  </div>
  <div id="chart-container"></div>

  <script>
    const margin = { top: 50, right: 90, bottom: 30, left: 90 };
    const width = 960;
    const dx = 10;
    const dy = width / 6;

    const tree = d3.tree().nodeSize([dx, dy]);

    // Define the diagonal function
    const diagonal = d3.linkVertical()
      .x(d => d.y)
      .y(d => d.x);

    // ...

    d3.csv("data.csv").then(function(data) {
      // Data preprocessing
      // ...

      const chart = () => {
        // ...

        const svg = d3.create("svg")
          .attr("viewBox", [-margin.left, -margin.top, width, dx])
          .style("font", "10px sans-serif")
          .style("user-select", "none");

        const gLink = svg.append("g")
          .attr("fill", "none")
          .attr("stroke-opacity", 0.4)
          .attr("stroke-width", 1.5);

        const gNode = svg.append("g")
          .attr("cursor", "pointer")
          .attr("pointer-events", "all");

        // ...

        // Update the links...
        const links = rootHierarchy.links(); // Define the links variable

        const link = gLink.selectAll("path")
          .data(links, d => d.target.id);

        // Enter any new links at the parent's previous position.
        const linkEnter = link.enter().append("path")
          .attr("d", d => {
            const o = { x: source.x0, y: source.y0 };
            return diagonal({ source: o, target: o });
          })
          .attr("stroke", d => colorScale(d.target.depth)) // Set the stroke color based on the target node's depth
          .attr("stroke-opacity", 0.4)
          .attr("stroke-width", 1.5);

        // ...

        // Append the SVG to the container
        const container = document.getElementById('chart-container');
        container.parentNode.insertBefore(svg.node(), container);
      };

      const container = document.getElementById('chart-container');
      container.appendChild(chart());
    });
  </script>
</body>
</html>
